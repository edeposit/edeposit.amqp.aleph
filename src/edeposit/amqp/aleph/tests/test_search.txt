*** Settings ***
Metadata    name  "Použití knihovny"
Library     inspector.Inspector
Library     OperatingSystem
Variables   variables.py
Library     XML

*** Keywords ***
Odeslání žádosti modulem
    Is type of    ${search_request}     ${edeposit.amqp.aleph.AlephQuery}    
    ${request_id}=    Call   edeposit.amqp.aleph.submit_search_request   ${search_request}

Žádost má správný typ
    Log   ahoj    
    
Modul se dotáže Alephu
    Log   ahoj
    
Modul stáhne detaily dokumentů
     Log   ahoj

Modul odešle pole detailu do exchange v RabbitMQ
    Log   v exchange se objevi jedna odpoved. V ni jsou vsechny zaznamy, co Aleph odpovedel.
        
Načtení jedné zprávy z RabbitMQ fronty
    Log       Aplikace nacte jednu zpravu. Zprava je zakodovana do transportniho formatu.
    
Převedení odpovědi na hledání do uživatelské struktury
    [Arguments]    ${data}   ${properties}   ${headers}
    [documentation]  Odpověd obsahuje všechny záznamy co Aleph odpověděl. Tj. jedna odpověd na jeden dotaz.
    ${result}=    Call   edeposit.amqp.aleph.convert_search_amqp_result   ${data}    ${properties}    ${headers}
    Is type of   ${result}   ${edeposit.amqp.aleph.AlephSearchResult}

Žádost o kontrolu ISBN má správný typ
    Log  Na to je struktura

Modul odešle počet záznamů do exchange v RabbitMQ
    Log   definovana struktura

Převedení odpovědi na počet do uživatelské struktury
    [Arguments]    ${data}   ${properties}   ${headers}
    [documentation]  Odpověd obsahuje počet záznamů a odpovídající dotaz. Také tam je uuid_of_request. Pro jistotu.
    Log   Vrátí uživatelskou strukturu
    
*** Test Cases ***
    
Dotaz na dokument se zadaným ISBN
    Žádost má správný typ
    Odeslání žádosti modulem
    Modul se dotáže Alephu
    Modul stáhne detaily dokumentů
    Modul odešle pole detailu do exchange v RabbitMQ
    Načtení jedné zprávy z RabbitMQ fronty
    ${result}=    Převedení odpovědi na hledání do uživatelské struktury    ${amqp_data}   ${amqp_properties}   ${amqp_headers}

Dotaz zda je ISBN uz použito
    [Documentation]   Aplikaci zajímá počet záznamů pro dané ISBN. modul se dotáže na isbn záznamy. Jestli existují, vrátí počet záznamů.
    Žádost o kontrolu ISBN má správný typ
    Odeslání žádosti modulem
    Modul se dotáže Alephu
    Modul odešle počet záznamů do exchange v RabbitMQ
    Načtení jedné zprávy z RabbitMQ fronty
    ${result}=    Převedení odpovědi na počet do uživatelské struktury    ${amqp_data}   ${amqp_properties}   ${amqp_headers}
    