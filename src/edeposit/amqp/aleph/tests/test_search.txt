*** Settings ***
Metadata    name  "Použití knihovny"
Library     inspector.Inspector
Library     OperatingSystem
Variables   variables.py
Library     XML

*** Keywords ***
Odeslání žádosti modulem
    ${request_id}=    Call   edeposit.amqp.aleph.submit_request   ${search_request}
    [return]  ${request_id}
        
Žádost má správný typ
    Is type of    ${search_request}     ${edeposit.amqp.aleph.AlephQuery}    
    
Modul se dotáže Alephu
    Log   ahoj
    
Modul stáhne detaily dokumentů
    Log   ahoj

Modul odešle pole detailu do exchange v RabbitMQ
    Log   v exchange se objevi jedna odpoved. V ni jsou vsechny zaznamy, co Aleph odpovedel.
        
Načtení jedné zprávy z RabbitMQ fronty
    Log       Aplikace nacte jednu zpravu. Zprava je zakodovana do transportniho formatu.
    
Převedení odpovědi na hledání do uživatelské struktury
    [Arguments]    ${data}   ${properties}   ${headers}
    [documentation]  Odpověd obsahuje všechny záznamy co Aleph odpověděl. Tj. jedna odpověd na jeden dotaz.
    ${result}=    Call   edeposit.amqp.aleph.convert_search_amqp_result   ${data}    ${properties}    ${headers}
    Is type of   ${result}   ${edeposit.amqp.aleph.AlephSearchResult}

Žádost na počet záznamů má správný typ
    Is type of    ${count_request}     ${edeposit.amqp.aleph.AlephCount}


Modul odešle počet záznamů do exchange v RabbitMQ
    Log   definovana struktura

Převedení odpovědi na počet do uživatelské struktury
    [Arguments]    ${data}   ${properties}   ${headers}
    [documentation]  Odpověd obsahuje počet záznamů a odpovídající dotaz. Také tam je uuid_of_request. Pro jistotu.
    Log   Vrátí uživatelskou strukturu
    
*** Test Cases ***
    
Dotaz na záznamy v Alephu
    Žádost má správný typ
    ${request_id} =  Odeslání žádosti modulem
    Modul se dotáže Alephu
    Modul stáhne detaily dokumentů
    Modul odešle pole detailu do exchange v RabbitMQ
    Načtení jedné zprávy z RabbitMQ fronty
    ${result}=    Převedení odpovědi na hledání do uživatelské struktury    ${amqp_data}   ${amqp_properties}   ${amqp_headers}

Dotaz na počet záznamů v Alephu
    [Documentation]   Aplikaci zajímá počet záznamů pro daný dotaz. Vrátí počet záznamů. Podle počtu záznamů aplikace může např. usoudit na existenci ISBN v Alephu
    Žádost na počet záznamů má správný typ
    Odeslání žádosti modulem
    Modul se dotáže Alephu
    Modul odešle počet záznamů do exchange v RabbitMQ
    Načtení jedné zprávy z RabbitMQ fronty
    ${result}=    Převedení odpovědi na počet do uživatelské struktury    ${amqp_data}   ${amqp_properties}   ${amqp_headers}

